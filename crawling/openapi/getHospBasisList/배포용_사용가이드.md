# 병원정보 조회 스크립트 v2.00 - 배포용 사용 가이드

**버전**: 2.00 (배포용)  
**작성일**: 2026-01-17  
**대상**: 스크립트를 처음 사용하는 사용자

---

## 📋 목차

1. [시작하기 전에](#시작하기-전에)
2. [필수 준비사항](#필수-준비사항)
3. [스크립트 설정 방법](#스크립트-설정-방법)
4. [실행 방법](#실행-방법)
5. [출력 파일 확인](#출력-파일-확인)
6. [문제 해결](#문제-해결)

---

## 시작하기 전에

### 이 스크립트가 하는 일

이 스크립트는 **건강보험심사평가원**의 병원정보서비스 API를 사용하여:
- 지역, 진료과목, 종별 등 다양한 조건으로 병원 검색
- 모든 페이지를 자동으로 조회하여 전체 데이터 수집
- CSV 파일로 결과 저장 (암호화된 요양기호 포함)

### 주요 기능

✅ **자동 페이징 처리** (전체 데이터 수집)  
✅ **중단 후 재개 가능** (체크포인트 기능)  
✅ **진행률 실시간 표시**  
✅ **암호화된 요양기호 포함** (상세정보 조회 시 필요)  
✅ **Excel 호환 CSV 저장** (한글 깨짐 없음)

---

## 필수 준비사항

### 1. Python 설치
- **Python 3.8 이상** 필요
- 설치 확인: 명령 프롬프트에서 `python --version` 실행

### 2. 필수 라이브러리 설치

명령 프롬프트(CMD) 또는 PowerShell에서 다음 명령어 실행:

```bash
pip install requests pandas
```

### 3. API 인증키 발급

#### 발급 절차
1. [공공데이터포털](https://www.data.go.kr) 접속
2. 회원가입 및 로그인
3. 검색창에 **"병원정보서비스"** 검색
4. **활용신청** 버튼 클릭
5. 신청 정보 입력 및 제출
6. 승인 후 (약 30분 소요) **마이페이지 > 인증키 발급현황**에서 확인
7. **디코딩 인증키** 복사 (일반 인증키가 아님!)

> ⚠️ **중요**: 반드시 **디코딩 인증키**를 사용하세요!

---

## 스크립트 설정 방법

### 1. 스크립트 파일 열기

`병원정보_조회_v2.00_배포용.py` 파일을 텍스트 에디터로 엽니다.
- 추천 에디터: VS Code, Notepad++, 메모장

### 2. 사용자 설정 영역 찾기

파일 상단에서 다음 섹션을 찾으세요:

```python
# ============================================================================
# ⚙️ 사용자 설정 영역 - 아래 항목들을 수정하세요
# ============================================================================
```

### 3. 필수 설정 항목

#### (1) 인증키 입력 ⭐ **필수**

```python
# 1. 인증키 설정 (필수)
SERVICE_KEY = "여기에_발급받은_디코딩_인증키를_입력하세요"
```

**수정 예시:**
```python
SERVICE_KEY = "Bk8LikYxwbpxf1OKF0mYYonK9RNmYo/mmgtNsZ41rRNxMuIh5s7RgflEXp+Xwp3R0FDR2j01gx62Hc++Jzc2pw=="
```

#### (2) 검색 조건 설정 ⭐ **필수**

기본 예시는 **서울 강남구 피부과**로 설정되어 있습니다:

```python
# 3. 검색 조건 설정
SEARCH_SIDO = '서울'           # 시도명
SEARCH_SGGU = '강남구'         # 시군구명
SEARCH_DGSBJ = '피부과'        # 진료과목
SEARCH_CL = None              # 종별 (None이면 전체)
SEARCH_YADM_NM = None         # 병원명 (None이면 전체)
SEARCH_EMDONG_NM = None       # 읍면동명 (None이면 전체)
```

**수정 예시 1: 서울 서초구 정형외과**
```python
SEARCH_SIDO = '서울'
SEARCH_SGGU = '서초구'
SEARCH_DGSBJ = '정형외과'
SEARCH_CL = None
SEARCH_YADM_NM = None
SEARCH_EMDONG_NM = None
```

**수정 예시 2: 특정 병원명으로 검색**
```python
SEARCH_SIDO = None
SEARCH_SGGU = None
SEARCH_DGSBJ = None
SEARCH_CL = None
SEARCH_YADM_NM = '서울의료원'
SEARCH_EMDONG_NM = None
```

**수정 예시 3: 부산 전체 종합병원**
```python
SEARCH_SIDO = '부산'
SEARCH_SGGU = None
SEARCH_DGSBJ = None
SEARCH_CL = '종합병원'
SEARCH_YADM_NM = None
SEARCH_EMDONG_NM = None
```

### 4. 선택 설정 항목

#### (1) API 키 타입 (일반적으로 수정 불필요)

```python
# 2. API 키 타입 설정
USE_ENCODED_KEY = False  # 디코딩 키 사용 (권장)
```

#### (2) 재시도 및 타임아웃 설정 (기본값 권장)

```python
# 4. 재시도 설정
MAX_RETRIES = 3          # 최대 재시도 횟수
RETRY_DELAY = 1          # 초기 재시도 대기 시간 (초)

# 5. 타임아웃 설정
CONNECT_TIMEOUT = 10     # 연결 타임아웃 (초)
READ_TIMEOUT = 60        # 읽기 타임아웃 (초)
```

#### (3) 체크포인트 설정 (기본값 권장)

```python
# 6. 체크포인트 설정
ENABLE_CHECKPOINT = True # 진행상황 저장 활성화
CHECKPOINT_INTERVAL = 5  # 5페이지마다 저장
```

#### (4) 출력 파일 설정

```python
# 7. 출력 파일 설정
OUTPUT_INCLUDE_YKIHO = True  # 암호화된 요양기호 포함 (상세정보 조회 시 필요)
```

### 5. 설정 완료 확인

다음 항목이 올바르게 설정되었는지 확인:
- [ ] `SERVICE_KEY`에 실제 인증키 입력
- [ ] `SEARCH_SIDO`, `SEARCH_SGGU`, `SEARCH_DGSBJ` 등 검색 조건 설정

---

## 실행 방법

### 1. 명령 프롬프트 열기

- **Windows**: `Win + R` → `cmd` 입력 → 엔터
- 또는 스크립트 파일이 있는 폴더에서 `Shift + 우클릭` → "여기서 PowerShell 창 열기"

### 2. 스크립트가 있는 폴더로 이동

```bash
cd "D:\git_gb4pro\crawling\openapi\getHospBasisList"
```

### 3. 스크립트 실행

```bash
python 병원정보_조회_v2.00_배포용.py
```

### 4. 실행 화면 예시

```
================================================================================
병원정보 조회 프로그램 v2.00
================================================================================

[검색 조건]
  - 시도: 서울
  - 시군구: 강남구
  - 진료과목: 피부과

[API 호출] 페이지: 1, 결과 수: 100
[진행] 전체 156건 중 0건 (0.0%)
[진행] 전체 156건 중 100건 (64.1%), 예상 남은 시간: 15초
[체크포인트 저장] checkpoint_20260117_084500.json
[API 호출] 페이지: 2, 결과 수: 100
[진행] 전체 156건 중 156건 (100.0%)
[완료] 총 156건 조회 완료
[체크포인트 삭제] checkpoint_20260117_084500.json

================================================================================
검색 결과: 총 156건
================================================================================

[1] 강남피부과의원
    종별: 의원
    주소: 서울특별시 강남구 테헤란로 123
    전화: 02-1234-5678
    의사수: 2명

[2] 서울피부과
    종별: 의원
    주소: 서울특별시 강남구 역삼동 456
    전화: 02-2345-6789
    의사수: 3명

... 외 154건

[CSV 저장 완료] data\서울_강남구_피부과_20260117_084530.csv (156건)
  - 암호화된 요양기호 포함됨 (상세정보 조회 API에 사용 가능)
```

### 5. 중단 및 재개

- **중단**: `Ctrl + C` 키 누르기
- **재개**: 같은 명령어로 다시 실행하면 자동으로 이어서 진행됩니다

---

## 출력 파일 확인

### 1. 출력 파일 위치

스크립트와 같은 폴더의 `data` 폴더에 저장됩니다:

```
D:\git_gb4pro\crawling\openapi\getHospBasisList\
└── data\
    └── 서울_강남구_피부과_20260117_084530.csv
```

### 2. CSV 파일 구조

#### 주요 컬럼
- **암호화요양기호**: 상세정보 조회 API에 사용 (중요!)
- **병원명**: 의료기관 이름
- **종별**: 의원, 병원, 종합병원 등
- **시도**: 시도명
- **시군구**: 시군구명
- **읍면동**: 읍면동명
- **주소**: 전체 주소
- **우편번호**: 우편번호
- **전화번호**: 대표 전화번호
- **홈페이지**: 병원 홈페이지 URL
- **개설일자**: 개설일자
- **의사총수**: 총 의사 수
- **의과전문의**: 의과 전문의 수
- **치과전문의**: 치과 전문의 수
- **한방전문의**: 한방 전문의 수
- **경도**: GPS 경도
- **위도**: GPS 위도

#### Excel에서 열기
- UTF-8 BOM 인코딩으로 저장되어 Excel에서 바로 열 수 있습니다
- 한글이 깨지지 않습니다

### 3. 다음 단계

이 CSV 파일은 **의료기관상세정보 조회 스크립트**의 입력 파일로 사용할 수 있습니다.
- 암호화된 요양기호를 사용하여 각 병원의 상세정보를 조회합니다
- 시설정보, 진료과목, 의료장비 등 11개 API의 상세 데이터를 수집합니다

---

## 문제 해결

### 1. 인증키 오류

```
[오류] 인증키를 설정하지 않았습니다.
```

**해결**: `SERVICE_KEY` 변수에 실제 인증키를 입력했는지 확인

---

```
API 오류 [30]: SERVICE_KEY_IS_NOT_REGISTERED_ERROR
```

**해결**: 
- 디코딩 인증키를 사용하고 있는지 확인
- 공공데이터포털에서 승인이 완료되었는지 확인 (약 30분 소요)
- 인증키 발급 후 30분 이상 경과했는지 확인

---

### 2. 검색 결과 없음

```
[결과 없음] 검색 조건에 맞는 병원이 없습니다.
```

**해결**:
- 검색 조건이 너무 구체적인지 확인
- 시도, 시군구 코드가 올바른지 확인
- 일부 조건을 `None`으로 설정하여 범위 확대

---

### 3. 트래픽 제한 초과

```
API 오류 [22]: LIMITED_NUMBER_OF_SERVICE_REQUESTS_EXCEEDS_ERROR
```

**해결**:
- 개발 계정은 일 1,000건 제한
- 다음 날 다시 시도
- 또는 운영 계정 신청

---

### 4. 라이브러리 설치 오류

```
ModuleNotFoundError: No module named 'requests'
```

**해결**:
```bash
pip install requests pandas
```

---

### 5. 네트워크 오류

```
네트워크 연결 오류
```

**해결**:
- 인터넷 연결 확인
- 방화벽 설정 확인
- 잠시 후 다시 시도 (스크립트가 자동으로 재시도합니다)

---

### 6. 시군구 코드 오류

```
KeyError: '강서구'
```

**해결**:
- 현재 서울 시군구 코드만 스크립트에 포함되어 있습니다
- 다른 지역의 시군구를 검색하려면 `SEARCH_SGGU = None`으로 설정하고 시도 전체를 검색하세요
- 또는 [API 가이드라인](getHospBasisList_api_guideline.md)을 참고하여 시군구 코드를 추가하세요

---

## 💡 사용 팁

### 1. 검색 조건 조합

다양한 조건을 조합하여 원하는 데이터를 수집할 수 있습니다:

```python
# 예시 1: 서울 전체 상급종합병원
SEARCH_SIDO = '서울'
SEARCH_SGGU = None
SEARCH_DGSBJ = None
SEARCH_CL = '상급종합병원'

# 예시 2: 경기도 전체 소아청소년과
SEARCH_SIDO = '경기'
SEARCH_SGGU = None
SEARCH_DGSBJ = '소아청소년과'
SEARCH_CL = None

# 예시 3: 전국 특정 병원명
SEARCH_SIDO = None
SEARCH_SGGU = None
SEARCH_DGSBJ = None
SEARCH_CL = None
SEARCH_YADM_NM = '서울대학교병원'
```

### 2. 진행 상황 모니터링

- 진행률과 예상 남은 시간이 실시간으로 표시됩니다
- 대량 데이터 수집 시 소요 시간을 예측할 수 있습니다

### 3. 체크포인트 활용

- 실행 중 중단되어도 걱정하지 마세요
- 다시 실행하면 자동으로 이어서 진행됩니다
- 체크포인트 파일: `checkpoint_YYYYMMDD_HHMMSS.json`

### 4. 암호화된 요양기호 활용

- 출력 CSV 파일의 첫 번째 컬럼에 암호화된 요양기호가 포함됩니다
- 이 요양기호를 사용하여 의료기관상세정보 조회 API를 호출할 수 있습니다
- 상세정보 조회 스크립트의 입력 파일로 바로 사용 가능합니다

---

## 📞 추가 도움말

### 관련 문서
- [README.md](README.md) - 전체 개요
- [API 가이드라인](getHospBasisList_api_guideline.md) - API 상세 설명
- [통합 사용 가이드](../통합_사용가이드.md) - 병원정보 조회 → 상세정보 조회 전체 워크플로우

### 공식 자료
- [공공데이터포털](https://www.data.go.kr)
- [건강보험심사평가원](https://www.hira.or.kr)

---

## 📊 지원하는 검색 조건

### 시도 (SIDO)
서울, 부산, 대구, 인천, 광주, 대전, 울산, 세종, 경기, 강원, 충북, 충남, 전북, 전남, 경북, 경남, 제주

### 서울 시군구 (SGGU)
강남구, 강동구, 강북구, 강서구, 관악구, 광진구, 구로구, 금천구, 노원구, 도봉구, 동대문구, 동작구, 마포구, 서대문구, 서초구, 성동구, 성북구, 송파구, 양천구, 영등포구, 용산구, 은평구, 종로구, 중구, 중랑구

### 진료과목 (DGSBJ)
일반의, 내과, 신경과, 정신건강의학과, 외과, 정형외과, 신경외과, 흉부외과, 성형외과, 마취통증의학과, 산부인과, 소아청소년과, 안과, 이비인후과, 피부과, 비뇨의학과, 가정의학과, 응급의학과

### 종별 (CL)
상급종합병원, 종합병원, 병원, 요양병원, 정신병원, 의원, 치과병원, 치과의원, 조산원, 보건소, 보건지소, 보건진료소, 보건의료원, 한방병원, 한의원

---

**문서 버전**: 1.0  
**최종 수정**: 2026-01-17  
**작성자**: OpenAPI 스크립트 개발팀
