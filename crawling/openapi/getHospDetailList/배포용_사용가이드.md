# 의료기관 전체정보 조회 스크립트 v2.00 - 배포용 사용 가이드

**버전**: 2.00 (배포용)  
**작성일**: 2026-01-16  
**대상**: 스크립트를 처음 사용하는 사용자

---

## 📋 목차

1. [시작하기 전에](#시작하기-전에)
2. [필수 준비사항](#필수-준비사항)
3. [스크립트 설정 방법](#스크립트-설정-방법)
4. [실행 방법](#실행-방법)
5. [출력 파일 확인](#출력-파일-확인)
6. [문제 해결](#문제-해결)

---

## 시작하기 전에

### 이 스크립트가 하는 일

이 스크립트는 **건강보험심사평가원**의 의료기관별상세정보서비스 API를 사용하여:
- 병원기본목록 CSV 파일을 읽어
- 각 병원에 대해 **11개 API를 자동으로 호출**하여
- 시설정보, 세부정보, 진료과목, 교통정보, 의료장비, 간호등급 등 **모든 상세정보를 수집**하고
- 하나의 CSV 파일로 통합하여 저장합니다

### 주요 기능

✅ **11개 API 자동 통합 조회**  
✅ **중단 후 재개 가능** (체크포인트 기능)  
✅ **진행률 실시간 표시**  
✅ **자동 메타데이터 생성** (데이터 품질 분석)  
✅ **테스트 모드 지원** (소량 데이터로 먼저 테스트)

---

## 필수 준비사항

### 1. Python 설치
- **Python 3.8 이상** 필요
- 설치 확인: 명령 프롬프트에서 `python --version` 실행

### 2. 필수 라이브러리 설치

명령 프롬프트(CMD) 또는 PowerShell에서 다음 명령어 실행:

```bash
pip install requests pandas
```

### 3. API 인증키 발급

#### 발급 절차
1. [공공데이터포털](https://www.data.go.kr) 접속
2. 회원가입 및 로그인
3. 검색창에 **"의료기관별상세정보서비스"** 검색
4. **활용신청** 버튼 클릭
5. 신청 정보 입력 및 제출
6. 승인 후 (약 30분 소요) **마이페이지 > 인증키 발급현황**에서 확인
7. **디코딩 인증키** 복사 (일반 인증키가 아님!)

> ⚠️ **중요**: 반드시 **디코딩 인증키**를 사용하세요!

### 4. 입력 CSV 파일 준비

병원기본목록 CSV 파일이 필요합니다. 이 파일에는 다음 컬럼이 포함되어야 합니다:
- **필수**: 암호화된 요양기호 (`ykiho`, `암호화요양기호`, `요양기호` 등)
- **권장**: 병원명, 주소 (원본 데이터 매핑용)

> 💡 **팁**: 병원기본목록은 별도의 API를 통해 먼저 수집해야 합니다.

---

## 스크립트 설정 방법

### 1. 스크립트 파일 열기

`의료기관전체정보_조회_v2.00_배포용.py` 파일을 텍스트 에디터로 엽니다.
- 추천 에디터: VS Code, Notepad++, 메모장

### 2. 사용자 설정 영역 찾기

파일 상단에서 다음 섹션을 찾으세요:

```python
# ============================================================================
# ⚙️ 사용자 설정 영역 - 아래 항목들을 수정하세요
# ============================================================================
```

### 3. 필수 설정 항목

#### (1) 인증키 입력 ⭐ **필수**

```python
# 1. 인증키 설정 (필수)
SERVICE_KEY = "여기에_발급받은_디코딩_인증키를_입력하세요"
```

**수정 예시:**
```python
SERVICE_KEY = "Bk8LikYxwbpxf1OKF0mYYonK9RNmYo/mmgtNsZ41rRNxMuIh5s7RgflEXp+Xwp3R0FDR2j01gx62Hc++Jzc2pw=="
```

#### (2) 입력 파일 경로 설정 ⭐ **필수**

```python
# 3. 입력 파일 설정 (필수)
INPUT_CSV_FILE = r"여기에_입력_CSV_파일_경로를_입력하세요"
```

**수정 예시:**
```python
# Windows 경로 예시
INPUT_CSV_FILE = r"C:\Users\사용자명\Documents\병원목록.csv"

# 또는 상대 경로
INPUT_CSV_FILE = r"data\병원목록.csv"
```

> 💡 **팁**: 경로 앞에 `r`을 붙이면 백슬래시(`\`)를 그대로 사용할 수 있습니다.

### 4. 선택 설정 항목

#### (1) 테스트 모드 (권장)

처음 실행 시 소량 데이터로 테스트하는 것을 권장합니다:

```python
# 8. 테스트 모드 설정
TEST_MODE = True         # True로 변경
MAX_TEST_RECORDS = 3     # 테스트할 레코드 수
```

#### (2) 요양기호 컬럼명 (선택)

일반적으로 자동 탐지되므로 수정 불필요:

```python
# 4. 요양기호 컬럼명 (선택사항)
YKIHO_COLUMN = None  # 자동 탐지
```

만약 자동 탐지가 실패하면 직접 지정:
```python
YKIHO_COLUMN = "ykiho"  # 또는 실제 컬럼명
```

#### (3) 재시도 및 타임아웃 설정

기본값 사용 권장:

```python
# 5. 재시도 설정
MAX_RETRIES = 3          # 최대 재시도 횟수
RETRY_DELAY = 1          # 초기 재시도 대기 시간 (초)

# 6. 타임아웃 설정
CONNECT_TIMEOUT = 10     # 연결 타임아웃 (초)
READ_TIMEOUT = 60        # 읽기 타임아웃 (초)
```

#### (4) 체크포인트 설정

중단 후 재개 기능 (기본값 사용 권장):

```python
# 7. 체크포인트 설정
ENABLE_CHECKPOINT = True # 진행상황 저장 활성화
CHECKPOINT_INTERVAL = 5  # 5건마다 저장
```

### 5. 설정 완료 확인

다음 항목이 올바르게 설정되었는지 확인:
- [ ] `SERVICE_KEY`에 실제 인증키 입력
- [ ] `INPUT_CSV_FILE`에 실제 파일 경로 입력
- [ ] (선택) `TEST_MODE = True`로 설정 (첫 실행 시)

---

## 실행 방법

### 1. 명령 프롬프트 열기

- **Windows**: `Win + R` → `cmd` 입력 → 엔터
- 또는 스크립트 파일이 있는 폴더에서 `Shift + 우클릭` → "여기서 PowerShell 창 열기"

### 2. 스크립트가 있는 폴더로 이동

```bash
cd "D:\git_gb4pro\crawling\openapi\getHospDetailList"
```

### 3. 스크립트 실행

```bash
python 의료기관전체정보_조회_v2.00_배포용.py
```

### 4. 실행 화면 예시

```
================================================================================
의료기관 전체정보 조회 프로그램 v2.00
================================================================================

[테스트 모드] 최대 3건만 처리합니다.

[CSV 읽기] data\병원목록.csv
  - 인코딩: utf-8-sig (성공)
  - 총 50건
  - 컬럼: ykiho, 병원명, 주소, ...
  - 요양기호 컬럼 자동 탐지: ykiho

[테스트 모드] 3건으로 제한

[진행] 0/3건 (0.0%)
  - 인덱스 0: 강남피부과의원
    [eqp] 시설정보: 성공 (15개 필드)
    [dtl] 세부정보: 성공 (42개 필드)
    [dgsbjt] 진료과목정보: 성공 (8개 필드)
    ...
    => 총 9/11개 API 성공

[진행] 1/3건 (33.3%), 예상 남은 시간: 45초
  - 인덱스 1: 서울피부과
    ...

[완료] 총 처리: 3건
[저장 완료] data\병원전체정보_20260116_021000.csv (3건, 156개 컬럼)
[메타데이터 생성] data\병원전체정보_20260116_021000.md
```

### 5. 중단 및 재개

- **중단**: `Ctrl + C` 키 누르기
- **재개**: 같은 명령어로 다시 실행하면 자동으로 이어서 진행됩니다

---

## 출력 파일 확인

### 1. 출력 파일 위치

스크립트와 같은 폴더의 `data` 폴더에 저장됩니다:

```
D:\git_gb4pro\crawling\openapi\getHospDetailList\
└── data\
    ├── 병원전체정보_20260116_021000.csv      ← 메인 데이터
    └── 병원전체정보_20260116_021000.md       ← 메타데이터 (자동 생성)
```

### 2. CSV 파일 구조

#### 주요 컬럼
- **원본 데이터**: `원본_기관코드`, `원본_병원명`, `원본_주소`
- **11개 API 데이터**: 각 API별로 접두사가 붙은 컬럼
  - `eqp_*`: 시설정보 (병상 수 등)
  - `dtl_*`: 세부정보 (병원명, 주소, 전화번호 등)
  - `dgsbjt_*`: 진료과목정보
  - `trnsprt_*`: 교통정보
  - `medoft_*`: 의료장비정보
  - `foepaddc_*`: 식대가산정보
  - `nursiggrd_*`: 간호등급정보
  - `spcldiag_*`: 특수진료정보
  - `spclhosp_*`: 전문병원지정분야
  - `spcsbtj_*`: 전문과목별전문의수
  - `etchst_*`: 기타인력수정보

#### Excel에서 열기
- UTF-8 BOM 인코딩으로 저장되어 Excel에서 바로 열 수 있습니다
- 한글이 깨지지 않습니다

### 3. 메타데이터 파일 (MD)

자동 생성되는 마크다운 파일에는 다음 정보가 포함됩니다:
- 📊 데이터 개요 (총 레코드 수, 컬럼 수)
- 📋 API별 수집 정보 통계
- 🔍 주요 컬럼 결측치 분석

---

## 문제 해결

### 1. 인증키 오류

```
[오류] 인증키를 설정하지 않았습니다.
```

**해결**: `SERVICE_KEY` 변수에 실제 인증키를 입력했는지 확인

---

```
API 오류 [30]: SERVICE_KEY_IS_NOT_REGISTERED_ERROR
```

**해결**: 
- 디코딩 인증키를 사용하고 있는지 확인
- 공공데이터포털에서 승인이 완료되었는지 확인 (약 30분 소요)

---

### 2. 파일 경로 오류

```
[오류] 입력 파일 경로를 설정하지 않았습니다.
```

**해결**: `INPUT_CSV_FILE` 변수에 실제 파일 경로를 입력했는지 확인

---

```
[오류] CSV 파일 읽기 실패: [Errno 2] No such file or directory
```

**해결**:
- 파일 경로가 올바른지 확인
- 파일이 실제로 존재하는지 확인
- 경로에 한글이 포함된 경우 `r"경로"` 형식 사용

---

### 3. 요양기호 컬럼 오류

```
요양기호 컬럼을 찾을 수 없습니다.
```

**해결**:
1. CSV 파일을 Excel로 열어 컬럼명 확인
2. 요양기호 컬럼명을 직접 지정:
   ```python
   YKIHO_COLUMN = "실제_컬럼명"
   ```

---

### 4. 트래픽 제한 초과

```
API 오류 [22]: LIMITED_NUMBER_OF_SERVICE_REQUESTS_EXCEEDS_ERROR
```

**해결**:
- 개발 계정은 일 1,000건 제한
- 다음 날 다시 시도
- 또는 운영 계정 신청

---

### 5. 라이브러리 설치 오류

```
ModuleNotFoundError: No module named 'requests'
```

**해결**:
```bash
pip install requests pandas
```

---

### 6. 네트워크 오류

```
네트워크 연결 오류
```

**해결**:
- 인터넷 연결 확인
- 방화벽 설정 확인
- 잠시 후 다시 시도 (스크립트가 자동으로 재시도합니다)

---

## 💡 사용 팁

### 1. 테스트 모드 활용

전체 데이터 실행 전 반드시 테스트:

```python
TEST_MODE = True
MAX_TEST_RECORDS = 3
```

성공 확인 후:

```python
TEST_MODE = False
```

### 2. 진행 상황 모니터링

- 진행률과 예상 남은 시간이 실시간으로 표시됩니다
- 각 병원별로 11개 API 성공 여부를 확인할 수 있습니다

### 3. 체크포인트 활용

- 실행 중 중단되어도 걱정하지 마세요
- 다시 실행하면 자동으로 이어서 진행됩니다
- 체크포인트 파일: `checkpoint_all_YYYYMMDD_HHMMSS.json`

### 4. 메타데이터 확인

- 수집 완료 후 `.md` 파일을 확인하세요
- API별 응답률을 파악할 수 있습니다
- 결측치 패턴을 분석할 수 있습니다

---

## 📞 추가 도움말

### 관련 문서
- [README.md](README.md) - 전체 개요
- [API 가이드라인](getHospDetailList_api_guideline.md) - API 상세 설명
- [개발 과정 문서](REPORT/개발과정_상세문서_20260115_184300.md) - 기술 세부사항

### 공식 자료
- [공공데이터포털](https://www.data.go.kr)
- [건강보험심사평가원](https://www.hira.or.kr)

---

**문서 버전**: 1.0  
**최종 수정**: 2026-01-16  
**작성자**: OpenAPI 스크립트 개발팀
